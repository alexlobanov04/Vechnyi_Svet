<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –±–∏–±–ª–µ–π—Å–∫–∏—Ö —Å—Ç–∏—Ö–æ–≤ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ä">
    <meta name="robots" content="noindex, nofollow">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/logo.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="icons/logo.svg">
    <title>–í–µ—á–Ω—ã–π –°–≤–µ—Ç</title>

    <!-- Local Fonts -->
    <link rel="stylesheet" href="css/fonts.css">

    <!-- Styles -->
    <link rel="stylesheet" href="css/controller.css?v=15">

    <!-- PDF.js and JSZip for presentation import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs" type="module"></script>
    <script type="module">
        import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.mjs';
        window.pdfjsLib = pdfjsLib;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/utif@3.1.0/UTIF.js"></script>
</head>

<body>
    <div class="app">
        <!-- Mobile Menu Toggle -->
        <button id="menu-toggle" class="btn-icon menu-toggle" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" aria-expanded="false">‚ò∞</button>
        <div id="sidebar-overlay" class="sidebar-overlay"></div>

        <!-- Sidebar Wrapper -->
        <div class="sidebar-wrapper">
            <!-- Inner Sidebar with hidden overflow -->
            <aside class="sidebar" role="complementary" aria-label="–ò—Å—Ç–æ—Ä–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏">
                <div class="sidebar-header">
                    <div class="logo">
                        <div class="logo-icon" aria-hidden="true">‚ú¶</div>
                        <span class="logo-text">–í–µ—á–Ω—ã–π –°–≤–µ—Ç</span>
                    </div>
                </div>

                <div id="history-section" class="sidebar-section">
                    <div class="section-header">
                        <span class="section-title">–ò—Å—Ç–æ—Ä–∏—è</span>
                        <button class="btn-icon history-clear-btn" data-action="clearHistory" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é"
                            aria-label="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é">üóë</button>
                    </div>
                    <div id="history" class="history-list" role="list" aria-label="–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∏—Ö–æ–≤">
                        <!-- History items rendered via JS -->
                    </div>
                </div>

                <div class="sidebar-footer">
                    <button class="btn btn-secondary u-style-1" data-action="toggleSettings"
                        aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Ä–∞–Ω–∞">
                        ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Ä–∞–Ω–∞
                    </button>
                    <button class="btn btn-secondary u-style-1" data-action="openDisplayWindow"
                        aria-label="–û—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–æ–µ–∫—Ç–æ—Ä–∞">
                        üñ•Ô∏è –û—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω
                    </button>

                </div>
            </aside>
            <!-- Toggle Button on Intersection -->
            <button id="sidebar-toggle-btn" class="sidebar-toggle-btn" title="–°–≤–µ—Ä–Ω—É—Ç—å/–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"
                aria-label="–°–≤–µ—Ä–Ω—É—Ç—å/–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å">‚óÄ</button>
        </div>

        <!-- Main -->
        <main class="main" role="main">
            <!-- Mode Switcher -->
            <div class="mode-switcher">
                <button id="btn-mode-bible" class="mode-btn active" data-action="switchMode" data-args="bible">üìñ
                    –ë–∏–±–ª–∏—è</button>
                <button id="btn-mode-songs" class="mode-btn" data-action="switchMode" data-args="songs">üéµ
                    –ü–µ—Å–Ω–∏</button>
                <button id="btn-mode-slides" class="mode-btn" data-action="switchMode" data-args="slides">üñºÔ∏è
                    –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</button>
                <button id="btn-mode-backgrounds" class="mode-btn" data-action="switchMode" data-args="backgrounds">üåÑ
                    –§–æ–Ω—ã</button>
            </div>

            <!-- BIBLE MODE -->
            <div id="mode-bible">
                <!-- Search Row -->
                <div class="search-row u-style-2">
                    <div class="search-container">
                        <span class="search-icon" aria-hidden="true">üîç</span>
                        <input type="text" id="search-input" class="search-input"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∏—Ö (–ò–Ω 3:16, –ë—ã—Ç 1:1-3...)" autocomplete="off"
                            aria-label="–ü–æ–∏—Å–∫ —Å—Ç–∏—Ö–∞">
                    </div>
                    <button class="btn btn-secondary" data-action="openTextSearch" title="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É"
                        aria-label="–û—Ç–∫—Ä—ã—Ç—å –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É">
                        üìñ –¢–µ–∫—Å—Ç
                    </button>
                    <button class="btn btn-secondary" data-action="openBibleNavModal"
                        title="–í–∏–∑—É–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–Ω–∏–≥–∞–º, –≥–ª–∞–≤–∞–º –∏ —Å—Ç–∏—Ö–∞–º" aria-label="–í–∏–∑—É–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
                        üìö –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    </button>
                    <select id="translation-select" class="translation-select" aria-label="–í—ã–±–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–∞">
                        <option value="RST">–°–∏–Ω–æ–¥–∞–ª—å–Ω—ã–π</option>
                        <option value="NRT">–ù–†–ü</option>
                        <option value="KTB">–ö–∞–∑–∞—Ö—Å–∫–∏–π (KTB)</option>
                        <option value="KYB">–ö—ã—Ä–≥—ã–∑—Å–∫–∏–π (KYB)</option>
                    </select>
                    <div id="status" class="status-pill" role="status" aria-live="polite">‚è≥ –ì–æ—Ç–æ–≤</div>
                </div>

                <!-- Bento Grid -->
                <div class="bento-grid">
                    <!-- Preview Card (Large) -->
                    <div class="bento-card large">
                        <div class="card-header">
                            <span class="card-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</span>
                            <div class="card-actions">
                                <button class="btn-icon" id="btn-edit" data-action="toggleEditMode"
                                    title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏—Ö">‚úèÔ∏è</button>
                                <button class="btn btn-ghost" id="btn-save" data-action="saveEdit"
                                    style="display:none;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button class="btn btn-ghost" id="btn-cancel" data-action="cancelEdit"
                                    style="display:none;">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                        <div class="verse-content">
                            <div id="verse-text" class="verse-text placeholder">
                                –í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—Ç–∏—Ö–∞...
                            </div>
                            <textarea id="edit-area" class="edit-area"
                                aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∏—Ö–∞"></textarea>
                            <div id="verse-ref" class="verse-ref"></div>
                        </div>
                    </div>

                    <!-- Quick Note Card -->
                    <div class="bento-card">
                        <div class="card-header">
                            <span class="card-label">–ë—ã—Å—Ç—Ä–∞—è –ó–∞–º–µ—Ç–∫–∞</span>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" data-action="showNote" class="u-style-3"
                                    aria-label="–¢—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫—É">
                                    üì° –í –≠—Ñ–∏—Ä
                                </button>
                            </div>
                        </div>
                        <div class="u-style-4">
                            <textarea id="note-input" class="edit-area active u-style-5"
                                placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è..." aria-label="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏"></textarea>
                            <label class="u-style-6">
                                <input type="checkbox" id="note-live-toggle" class="u-style-7">
                                –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä (–ü–µ—á–∞—Ç–∞—Ç—å —Å—Ä–∞–∑—É –Ω–∞ —ç–∫—Ä–∞–Ω)
                            </label>
                        </div>
                    </div>

                    <!-- Live Control Card -->
                    <div class="bento-card">
                        <div class="card-header">
                            <span class="card-label">–≠—Ñ–∏—Ä</span>
                            <div class="status-indicator live-pulse"></div>
                        </div>
                        <div class="u-style-8">
                            <!-- Mini Preview Window -->
                            <div class="mini-preview-box global-mini-preview">
                                <div class="mini-text placeholder global-mini-text">–≠–∫—Ä–∞–Ω –ø—É—Å—Ç</div>
                                <div class="mini-ref global-mini-ref" style="display: none;"></div>
                            </div>

                            <!-- Broadcast & Navigation Row -->
                            <div class="u-style-10">
                                <button class="btn btn-secondary u-style-11" data-action="goToPrevVerse"
                                    title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∏—Ö (‚Üë)" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∏—Ö">
                                    ‚óÄ
                                </button>

                                <button class="btn btn-success u-style-9" id="btn-broadcast"
                                    data-action="broadcastToDisplay" disabled aria-label="–¢—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏—Ö">
                                    üì° –°—Ç–∏—Ö –≤ –≠—Ñ–∏—Ä
                                </button>

                                <button class="btn btn-secondary u-style-11" data-action="goToNextVerse"
                                    title="–°–ª–µ–¥—É—é—â–∏–π —Å—Ç–∏—Ö (‚Üì)" aria-label="–°–ª–µ–¥—É—é—â–∏–π —Å—Ç–∏—Ö">
                                    ‚ñ∂
                                </button>
                            </div>

                            <button class="btn btn-secondary" data-action="hideFromDisplay" title="–û—á–∏—Å—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω"
                                class="u-style-13" aria-label="–°–∫—Ä—ã—Ç—å —Å —ç–∫—Ä–∞–Ω–∞">
                                ‚¨õ –°–∫—Ä—ã—Ç—å (Esc)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SONGS MODE -->
            <div id="mode-songs" style="display: none;">
                <!-- Song Search Row -->
                <div class="search-row u-style-2">
                    <div class="search-container">
                        <span class="search-icon" aria-hidden="true">üéµ</span>
                        <input type="text" id="song-search-input" class="search-input"
                            placeholder="–ü–æ–∏—Å–∫ –ø–µ—Å–Ω–∏ (–Ω–æ–º–µ—Ä, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ —Ç–µ–∫—Å—Ç)" autocomplete="off"
                            aria-label="–ü–æ–∏—Å–∫ –ø–µ—Å–Ω–∏">
                    </div>
                    <select id="songbook-select" class="translation-select" aria-label="–í—ã–±–æ—Ä —Å–±–æ—Ä–Ω–∏–∫–∞">
                    </select>
                    <button class="btn btn-primary" data-action="openAddSongModal" aria-label="–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>

                <!-- Songs Content -->
                <div class="songs-container u-style-15">
                    <!-- Song List -->
                    <div class="bento-card u-style-16">
                        <div class="card-header">
                            <span class="card-label">–°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω</span>
                            <div class="u-style-17" id="songs-count">0 –ø–µ—Å–µ–Ω</div>
                        </div>
                        <div id="songs-list" class="history-list u-style-18">
                            <!-- Items via JS -->
                        </div>
                    </div>

                    <!-- Song Preview -->
                    <div class="bento-card large u-style-19">
                        <div class="card-header">
                            <span class="card-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</span>
                            <div class="card-actions">
                                <button class="btn-icon" data-action="editCurrentSong" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                                <button class="btn btn-success" data-action="broadcastSong" id="btn-broadcast-song"
                                    disabled>üì° –í –≠—Ñ–∏—Ä</button>
                            </div>
                        </div>
                        <div class="verse-content u-style-20">
                            <div id="song-preview-text" class="verse-text placeholder song-preview-container">
                            </div>
                        </div>
                        <div class="card-footer u-style-21"
                            style="flex-direction: column; align-items: stretch; gap: 12px;">
                            <div class="mini-preview-box global-mini-preview" style="margin-bottom: 0;">
                                <div class="mini-text placeholder global-mini-text">–≠–∫—Ä–∞–Ω –ø—É—Å—Ç</div>
                                <div class="mini-ref global-mini-ref" style="display: none;"></div>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                <div class="song-nav-group">
                                    <button class="btn btn-secondary song-nav-btn" data-action="goToPrevStanza"
                                        title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –∫—É–ø–ª–µ—Ç (‚Üê)">‚óÑ</button>
                                    <button class="btn btn-secondary song-nav-btn" data-action="goToNextStanza"
                                        title="–°–ª–µ–¥—É—é—â–∏–π –∫—É–ø–ª–µ—Ç (‚Üí)">‚ñ∫</button>
                                </div>
                                <button class="btn btn-secondary" data-action="hideFromDisplay"
                                    aria-label="–°–∫—Ä—ã—Ç—å —Å —ç–∫—Ä–∞–Ω–∞">
                                    ‚¨õ –°–∫—Ä—ã—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SLIDES MODE -->
            <div id="mode-slides" style="display: none;">
                <div class="search-row u-style-2">
                    <div class="u-style-22">–í–∞—à–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</div>
                    <button class="btn btn-primary" data-action="openCreatePresentationModal"
                        aria-label="–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å
                    </button>
                </div>

                <div class="slides-container">
                    <!-- Presentation List -->
                    <div class="bento-card u-style-16">
                        <div class="card-header u-style-23">
                            <select id="pres-category-filter" class="form-select u-style-24"
                                onchange="renderPresentationList()">
                                <option value="sermons">–ü—Ä–æ–ø–æ–≤–µ–¥–∏</option>
                                <option value="songs">–ü–µ—Å–Ω–∏</option>
                                <option value="trash">üóëÔ∏è –ö–æ—Ä–∑–∏–Ω–∞</option>
                            </select>
                            <div class="u-style-25" id="slides-count">0</div>
                        </div>
                        <div id="presentations-list" class="history-list u-style-18">
                            <!-- Items via JS -->
                        </div>
                    </div>

                    <!-- Slide Preview -->
                    <div class="bento-card large u-style-19">
                        <div class="card-header">
                            <span class="card-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</span>
                            <div class="card-actions">
                                <button class="btn-icon" data-action="deleteCurrentPresentation"
                                    title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é">üóëÔ∏è</button>
                                <button class="btn btn-success" data-action="broadcastSlide" id="btn-broadcast-slide"
                                    disabled>üì° –í –≠—Ñ–∏—Ä</button>
                            </div>
                        </div>
                        <div id="slide-preview-area" class="slide-preview-area">
                            <div id="slide-preview-placeholder" class="verse-text placeholder">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –∏–∑
                                —Å–ø–∏—Å–∫–∞</div>
                            <img id="slide-preview-img" class="slide-preview-img" style="display:none;" alt="–°–ª–∞–π–¥">
                        </div>
                        <div id="slide-thumbnails" class="slide-thumbnails"></div>
                        <div class="card-footer u-style-26"
                            style="flex-direction: column; align-items: stretch; gap: 12px;">
                            <div class="mini-preview-box global-mini-preview" style="margin-bottom: 0;">
                                <div class="mini-text placeholder global-mini-text">–≠–∫—Ä–∞–Ω –ø—É—Å—Ç</div>
                                <div class="mini-ref global-mini-ref" style="display: none;"></div>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                <div class="song-nav-group">
                                    <button class="btn btn-secondary song-nav-btn" data-action="goToPrevSlide"
                                        title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥ (‚Üê)">‚óÑ</button>
                                    <span id="slide-counter" class="u-style-27"></span>
                                    <button class="btn btn-secondary song-nav-btn" data-action="goToNextSlide"
                                        title="–°–ª–µ–¥—É—é—â–∏–π —Å–ª–∞–π–¥ (‚Üí)">‚ñ∫</button>
                                </div>
                                <button class="btn btn-secondary" data-action="hideFromDisplay"
                                    aria-label="–°–∫—Ä—ã—Ç—å —Å —ç–∫—Ä–∞–Ω–∞">‚¨õ
                                    –°–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BACKGROUNDS MODE -->
            <div id="mode-backgrounds" class="u-style-28">
                <div class="search-row u-style-2">
                    <div class="u-style-22">–§–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    <button class="btn btn-secondary" data-action="hideFromDisplay" aria-label="–°–∫—Ä—ã—Ç—å —Å —ç–∫—Ä–∞–Ω–∞">
                        ‚¨õ –°–∫—Ä—ã—Ç—å
                    </button>
                </div>

                <!-- Split Upload + Preview Area -->
                <div class="bg-split-zone">
                    <!-- Left: Upload / Drag & Drop -->
                    <div class="bento-card bg-upload-half">
                        <div id="bg-drop-zone" class="slide-drop-zone bg-drop-inner">
                            <div class="drop-zone-content">
                                <span class="bg-drop-icon">üåÑ</span>
                                <p class="bg-drop-label">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è<br>(JPG, PNG, WebP, TIFF)</p>
                                <label class="btn btn-secondary bg-drop-btn">
                                    –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                                    <input type="file" id="bg-file-input" accept="image/*,.tiff,.tif" multiple
                                        style="display: none;">
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Live Preview -->
                    <div class="bento-card bg-preview-half">
                        <div class="bg-preview-label">–≠–ö–†–ê–ù</div>
                        <div class="mini-preview-box global-mini-preview bg-live-preview">
                            <div class="mini-text placeholder global-mini-text">–≠–∫—Ä–∞–Ω –ø—É—Å—Ç</div>
                            <div class="mini-ref global-mini-ref" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Gallery Grid -->
                <div class="bento-card u-style-34">
                    <div class="card-header">
                        <span class="card-label">–ì–∞–ª–µ—Ä–µ—è</span>
                        <div class="u-style-17" id="bg-count">0</div>
                    </div>
                    <div id="bg-gallery" class="u-style-35">
                        <!-- Gallery items populated by JS -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Slides Modal -->
    <div id="slides-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="slides-modal-title">
        <div class="modal">
            <div class="modal-header">
                <h2 id="slides-modal-title" class="modal-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–µ–π</h2>
                <button class="btn-icon close-modal" data-action="closeSlidesModal"
                    aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">√ó</button>
            </div>
            <div class="modal-body">
                <!-- ... placeholder ... -->
            </div>
        </div>
    </div>

    <!-- Bible Navigation Modal -->
    <div id="bible-nav-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="bible-nav-modal-title">
        <div class="modal u-style-36">
            <div class="modal-header">
                <button class="btn-icon btn-icon-xs" id="bible-nav-back" data-action="bibleNavGoBack" aria-label="–ù–∞–∑–∞–¥"
                    style="display: none;">‚óÄ</button>
                <h2 id="bible-nav-modal-title" class="u-style-37">–í—ã–±–µ—Ä–∏—Ç–µ
                    –∫–Ω–∏–≥—É</h2>
                <button class="btn-icon btn-icon-sm close-modal" data-action="closeBibleNavModal"
                    aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">√ó</button>
            </div>
            <div class="modal-body u-style-38">
                <div id="bible-nav-content">
                    <!-- Content dynamically injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="modal">
            <div class="modal-header">
                <h2 id="settings-title" class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Ä–∞–Ω–∞</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="font-select">–®—Ä–∏—Ñ—Ç —Å—Ç–∏—Ö–æ–≤</label>
                    <select id="font-select" class="form-select">
                        <option value="'Playfair Display', serif">Playfair Display</option>
                        <option value="'Inter', sans-serif">Inter</option>
                        <option value="'Georgia', serif">Georgia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="theme-select">–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="color" id="theme-select" value="#000000"
                            style="width: 50px; height: 38px; padding: 0; border: none; border-radius: var(--radius); cursor: pointer; background: none;"
                            title="–í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç">
                        <input type="text" id="theme-hex" placeholder="#HEX"
                            style="width: 90px; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius); outline: none; background: var(--bg-secondary); color: var(--text-primary); font-family: monospace;"
                            maxlength="7">
                        <span style="font-size: 0.9em; color: var(--text-secondary);">–∏–ª–∏ —Å–≤–æ–π HEX</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="text-color-select">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="color" id="text-color-select" value="#ffffff"
                            style="width: 50px; height: 38px; padding: 0; border: none; border-radius: var(--radius); cursor: pointer; background: none;"
                            title="–í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç">
                        <input type="text" id="text-color-hex" placeholder="#HEX"
                            style="width: 90px; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius); outline: none; background: var(--bg-secondary); color: var(--text-primary); font-family: monospace;"
                            maxlength="7">
                        <span style="font-size: 0.9em; color: var(--text-secondary);">–∏–ª–∏ —Å–≤–æ–π HEX</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="size-range">–†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</label>
                    <input type="range" id="size-range" class="form-range" min="80" max="150" value="100">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-action="toggleSettings">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <!-- Text Search Modal -->
    <div id="text-search-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="text-search-title">
        <div class="modal u-style-39">
            <div class="modal-header">
                <h2 id="text-search-title" class="modal-title">üìñ –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="text-search-input" class="search-input"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É –¥–ª—è –ø–æ–∏—Å–∫–∞..." class="u-style-40"
                        aria-label="–¢–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞">
                </div>
                <div id="text-search-results" class="search-results" role="list" aria-label="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞"
                    class="u-style-41">
                    <div class="search-results-placeholder u-style-42">
                        –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ Enter
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span id="text-search-count" class="u-style-43"></span>
                <button class="btn btn-secondary" data-action="closeTextSearch">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Song Modal -->
    <div id="song-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="song-modal-title">
        <div class="modal u-style-39">
            <div class="modal-header">
                <h2 id="song-modal-title" class="modal-title">üéµ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é</h2>
            </div>
            <div class="modal-body">
                <input type="hidden" id="song-id">
                <div class="u-style-44">
                    <div class="form-group u-style-45">
                        <label class="form-label">–ù–æ–º–µ—Ä</label>
                        <input type="text" id="song-number" class="search-input" placeholder="‚Ññ" class="u-style-46">
                    </div>
                    <div class="form-group u-style-47">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="song-title" class="search-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏"
                            class="u-style-46">
                    </div>
                </div>
                <div class="form-group u-style-48">
                    <label class="form-label">–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏</label>
                    <textarea id="song-text" class="edit-area active u-style-49"
                        placeholder="–ü—Ä–∏–º–µ—Ä:&#10;[–ö—É–ø–ª–µ—Ç 1]&#10;–¢–µ–∫—Å—Ç –∫—É–ø–ª–µ—Ç–∞...&#10;&#10;[–ü—Ä–∏–ø–µ–≤]&#10;–¢–µ–∫—Å—Ç –ø—Ä–∏–ø–µ–≤–∞..."></textarea>

                    <div class="u-style-50">
                        <button class="btn btn-secondary" data-action="insertSongTag" data-args="[–ö—É–ø–ª–µ—Ç]" type="button"
                            class="u-style-51">
                            <span class="u-style-52">+</span>
                            <span class="u-style-53">–ö—É–ø–ª–µ—Ç</span>
                        </button>
                        <button class="btn btn-secondary" data-action="insertSongTag" data-args="[–ü—Ä–∏–ø–µ–≤]" type="button"
                            class="u-style-51">
                            <span class="u-style-52">+</span>
                            <span class="u-style-53">–ü—Ä–∏–ø–µ–≤</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeSongModal">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" data-action="saveSongForm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Create Presentation Modal -->
    <div id="presentation-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="pres-modal-title">
        <div class="modal u-style-54">
            <div class="modal-header">
                <h2 id="pres-modal-title" class="modal-title">üñºÔ∏è –ù–æ–≤–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</h2>
            </div>
            <div class="modal-body">
                <div class="u-style-55">
                    <div class="form-group u-style-47">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="pres-title" class="search-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–æ–∂–¥–µ—Å—Ç–≤–æ 2026"
                            class="u-style-46">
                    </div>
                    <div class="form-group u-style-45">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="pres-category" class="form-select">
                            <option value="sermons">–ü—Ä–æ–ø–æ–≤–µ–¥—å</option>
                            <option value="songs">–ü–µ—Å–Ω—è</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–§–∞–π–ª—ã (PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)</label>
                    <div id="slide-drop-zone" class="slide-drop-zone">
                        <div class="drop-zone-content">
                            <span class="u-style-56">üìÅ</span>
                            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</p>
                            <p class="u-style-17">PDF, JPG, PNG, WebP (–î–ª—è PowerPoint
                                —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ PDF)</p>
                            <label class="btn btn-secondary u-style-57">
                                –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                                <input type="file" id="slide-file-input" accept=".pdf,image/*" multiple
                                    style="display: none;">
                            </label>
                        </div>
                    </div>
                </div>
                <div id="upload-preview-grid" class="upload-preview-grid"></div>
                <div id="upload-status" class="u-style-58">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closePresentationModal">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" data-action="savePresentationForm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading-overlay" role="status" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞">
        <div class="loader" aria-hidden="true"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ë–∏–±–ª–∏–∏...</div>
        <div id="loading-progress" class="loading-progress">
            <div id="loading-bar" class="loading-bar"></div>
        </div>
        <div id="loading-status" class="loading-status">0 / 4 –ø–µ—Ä–µ–≤–æ–¥–æ–≤</div>
        <button class="btn btn-secondary u-style-59" data-action="skipLoading">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
    </div>

    <!-- Data dependencies (load defer) -->
    <script src="js/data/bible_data.js"></script>
    <script src="js/data/nrt_data.js"></script>
    <script src="js/data/ktb_data.js"></script>
    <script src="js/data/kyb_data.js"></script>
    <script src="js/data/songs_data.js"></script>

    <!-- Force purge old Service Worker cache (one-time) -->
    <script>
        (function () {
            const SW_PURGE_KEY = 'sw_purge_v16';
            if (!localStorage.getItem(SW_PURGE_KEY)) {
                localStorage.setItem(SW_PURGE_KEY, '1');
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(function (regs) {
                        regs.forEach(function (r) { r.unregister(); });
                    });
                    caches.keys().then(function (keys) {
                        keys.forEach(function (k) { caches.delete(k); });
                    });
                    setTimeout(function () { location.reload(true); }, 800);
                }
            }
        })();
    </script>

    <!-- Main Application (ES Module) -->
    <script type="module" src="js/app.js?v=14"></script>


</body>

</html>